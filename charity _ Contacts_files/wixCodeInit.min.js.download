"use strict";define("wixCodeInit/utils/urlBuilder",[],function(){function e(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function t(e){return/^https?:\/\/localhost\/?$/.test(e)}function n(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/SNAPSHOT\/santa?$/.test(e)}function i(e){return/^\d+\.\d+\.\d+$/.test(e)}function r(e,t){var n=e.lastIndexOf("/");return i(t)?e.substring(0,n+1)+t:e}function o(e,i){var o=e.serviceTopology,a=t(e.santaBase)||n(e.santaBase)?o.scriptsLocationMap.santa:e.santaBase;return a=r(a,i),/(.*\/services\/)?(.*)/.exec(a)[2]}function a(t,n,i){var r="//"+n.instanceId+".",a=t.serviceTopology.wixCloudBaseDomain,s="node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");return r+e(a,"_partials",o(t,i.runtimeSource),s)}function s(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function d(e,t,n){var i=a(e,t,n=n||{}),r=!!e.publicModel,o={compId:"wixCode_"+t.appDefinitionId,deviceType:n.isMobileView?"mobile":"desktop",viewMode:r?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode,wixCodeBase:e.santaBase+"/node_modules/santa-wix-code"};return n.sdkSource&&(o.sdkSource=n.sdkSource),n.applications&&(o.applications=JSON.stringify(n.applications)),n.ReactSource&&(o.ReactSource=n.ReactSource),i+"?"+s(o)}return{buildUrl:d}}),define("wixCodeInit/utils/messageHolder",[],function(){function e(){var e=[],t=null;return{sendOrHoldMessage:function(n){t?t(n):e.push(n)},setMessageTarget:function(n){for(t=n;e.length>0;)t(e.shift())}}}return{get:e}}),define("wixCodeInit/utils/iFrameUtils",[],function(){function e(e,t){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%; background: transparent;",n.src=e,n.setAttribute("data-app-id",t.applicationId),n.setAttribute("data-app-definition-id",t.appDefinitionId),n}function t(e,t){return t.source===e.contentWindow}return{getIFrameForApp:e,isIFrameEvent:t}}),define("wixCodeInit/utils/appsUtils",["lodash"],function(e){function t(t,n){var i;return e.forEach(n,function(e){var n=t.getDynamicPageData(e);n&&(i=n)}),i}function n(n,i,r){if(n){var o=t(n,r);if(o){var a=o.routerData,s=o.routerDefinition;if(a&&s)if("wix-code"===s.appDefinitionId)e.forEach(r,function(t){e.forEach(i,function(e){e.id===t&&(e.routerData=a)})});else{var d=e.find(i,{id:s.appDefinitionId});d&&(d.routerData=a)}}}}function i(t){var n={displayName:"siteextension"};return e(t).reject(n).map(function(t){return e.assign({type:v.APPLICATION},t)}).value()}function r(e){return!!e.wixCodeModel}function o(t,n,i,o,a){if(r(o.rendererModel)&&e.find(t,n)){var s=o.isPlatformAppOnPage("masterPage","wixCode");e.forEach(i,function(e){var t=o.isPlatformAppOnPage(e,"wixCode"),n=o.getDataByQuery(e).isPopup;t&&a.push({id:e,type:n?v.POPUP:v.PAGE,displayName:o.getPageTitle(e)}),!n&&s&&a.push({id:e,type:v.MASTER_PAGE})})}}function a(t,r,a){t=e.without(t,"masterPage");var s={displayName:"siteextension"},d=i(a);return o(a,s,t,r,d),n(r,d,t),d}function s(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function d(e,t,n){var i=s(e.scriptsDomainUrl,"services",t);return n?s(i,n):e.scriptsLocationMap[t]}function u(t,n,i){if(e.get(t,"port")&&e.get(t,"path")&&e.get(t,"id")){i=e.endsWith(i,"/")?i.slice(0,-1):i;var r,o=e.template("<%= santaBase %><%= port %>/<%= path %>");r=o("80"===t.port?{santaBase:i,port:"",path:t.path}:{santaBase:i,port:":"+t.port,path:t.path}),n.push({type:v.APPLICATION,id:t.id,url:r,displayName:t.id})}}function p(t,n,i,o,a){r(a)&&e.find(t,{type:"siteextension"})&&!e.find(n,{id:"dataBinding"})&&n.push({type:v.APPLICATION,id:"dataBinding",url:s(d(i,"dbsm-viewer-app",o.dataBinding),"/app.js"),displayName:"Data Binding"})}function c(t,n){return e(t).filter(function(t){return r(n)&&"siteextension"===t.type||e.get(t,"platformApp.viewerUrl")}).map(function(t){var n={id:t.appDefinitionId,displayName:t.type,appInnerId:t.applicationId},i=e.get(t,"platformApp.viewerUrl");return i&&(n.url=i),n}).value()}function l(e){var t=c(e.clientSpecMap,e.rendererModel),n=w(e.viewerPlatformAppSources);return u(n,t,e.santaBase),p(e.clientSpecMap,t,e.serviceTopology,n,e.rendererModel),t}function f(t){var n=l(t);return e.filter(i(n),"url")}function g(t,n,i){return a(n,i,l({clientSpecMap:t,viewerPlatformAppSources:e.get(i,["currentUrl","query","viewerPlatformAppSources"]),serviceTopology:i.serviceTopology,santaBase:i.santaBase,rendererModel:i.rendererModel}))}function w(t){return e(t||"").split(",").invokeMap("split",":").fromPairs().value()}function m(t,n,i){return e.reject(g(t,n,i),{type:v.APPLICATION})}var v={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};return{getApplications:g,getUserCodeDefinitions:m,getAppsBaseInfo:f}}),define("wixCodeInit/utils/widgetsPreLoader",["wixCodeInit/utils/appsUtils"],function(e){function t(e,t,n,i){if(a())return p.push([e,t,n,i]),void requirejs(["utils","widgets","wixCode"],o);var r=i(s);r.currentUrl=s.urlUtils.parseUrl(e);var c=s.wixUrlParser.parseUrl(r,e),l=c&&c.pageId;if(l){var f=t(d,r,l),g=u.wixCodeWidgetService.getWixCodeSpec(r.getClientSpecMap());n(u.messageBuilder.getExtendedMessage(f,r.rendererModel.wixCodeModel||{},g,r))}}function n(n,i,r){t(i,function(t,i,r){var o=e.getApplications(n.rendererModel.clientSpecMap,[r],i),a=n.routers||{configMap:{}};return t.messageBuilder.loadWidgetsMessage(o,a.configMap,[r])},r,function(e){return new e.FullSiteData(n,function(){})})}function i(n,i,r){t(i,function(t,i,r){var o=e.getUserCodeDefinitions(n.rendererModel.clientSpecMap,[r],i);return t.messageBuilder.loadUserCodesMessage(o,[r])},r,function(e){return new e.FullSiteData(n,function(){})})}function r(e,n,i){t(n,function(e,t,n){var i={};return i[n]=e.widgetService.getControllersToInit(t,n),e.messageBuilder.initWidgetsMessage(i)},i,function(){return e})}function o(e,n,i){if(a()){s=e,d=n,u=i;for(var r=0;r<p.length;r++)t.apply(null,p[r]);p.length=0}}function a(){return!s||!d||!u}var s=null,d=null,u=null,p=[];return{asyncGetPreLoadMessage:n,asyncGetPreLoadUserCodeMessage:i,asyncGetPreInitMessage:r,registerDeps:o}}),define("wixCodeInit/utils/specMapUtils",[],function(){function e(e){for(var n in e)if(e.hasOwnProperty(n)&&e[n].type===t)return e[n]}var t="siteextension";return{getAppSpec:e}}),define("wixCodeInit/api/wixCodeAppApi",["wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils"],function(e,t,n,i,r){function o(e){return"WIX_CODE"===e.intent&&"wix_code_iframe_loaded"===e.type}function a(e){return"WIX_CODE_SITE_API"===e.intent&&"reportBI"===e.type}function s(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild)}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}function d(e){return!!e.rendererModel.wixCodeModel}function u(){function u(e,t){if(n.isIFrameEvent(e,t)){if(o(t.data)&&C.setMessageTarget(function(t){e.contentWindow.postMessage(t,"*")}),a(t.data)&&!M.length&&"undefined"!=typeof window){var i=t.data.reportDef,r=t.data.params;i.errorCode?window.wixBiSession.sendError(i,r.p1,r.p2,r.p3,r.p4):window.wixBiSession.sendBI(i.endpoint,i.eventId,i.src,r)}M.forEach(function(e){e(t.data)})}}function p(t,i,o){if(x)console.warn("Wix code is already initiated");else if(d(t)){var a=r.getAppSpec(i),p=e.buildUrl(t,a,o),c=n.getIFrameForApp(p,a),l=u.bind(null,c);window.addEventListener("message",l,!1),s(c),x=!0}}function c(e){M.push(e)}function l(e){I.push(e)}function f(e){var t=e;return I.forEach(function(e){t=e(t)}),t}function g(e){e&&C.sendOrHoldMessage(f(e))}function w(e,t){!y&&d(e)&&i.asyncGetPreLoadMessage(e,t,function(e){P&&!y&&(y=e,C.sendOrHoldMessage(y))})}function m(e,t){!A&&d(e)&&i.asyncGetPreLoadUserCodeMessage(e,t,function(e){A||(A=e,C.sendOrHoldMessage(A))})}function v(e,t){!h&&d(e)&&i.asyncGetPreInitMessage(e,t,function(e){h||(h=e,C.sendOrHoldMessage(h))})}var M=[],I=[],C=t.get(),x=!1,P=!0,y=null,A=null,h=null;return{init:p,sendMessage:g,registerMessageHandler:c,registerMessageModifier:l,preLoadWidgets:w,preLoadUserCode:m,preInitWidgets:v}}return{getApi:u}}),define("wixCodeInit/api/initMainR",["lodash","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils"],function(e,t,n){function i(i,r,o,a,s){function d(e){return t.getAppSpec(e)||p.applications.length}s=s||window.document.location.href;var u=e.trimEnd(r.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/wix.min.js",p={isMobileView:o,sdkSource:a.getParameterByName("sdkSource")||u,runtimeSource:a.getParameterByName("WixCodeRuntimeSource"),ReactSource:a.getParameterByName("ReactSource"),useWixCodeFallback:"true"===a.getParameterByName("useWixCodeFallback")||!window.Worker},c=a.getParameterByName("viewerPlatformAppSources");p.applications=n.getAppsBaseInfo({rendererModel:r.rendererModel,clientSpecMap:r.rendererModel.clientSpecMap,serviceTopology:r.serviceTopology,viewerPlatformAppSources:c,santaBase:r.santaBase}),function(e){i.init(r,e,p),d(e)&&(i.preLoadUserCode(r,s),!!r.publicModel&&i.preLoadWidgets(r,s))}(r.rendererModel.clientSpecMap)}return i}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils","wixCodeInit/utils/widgetsPreLoader"],function(e,t,n,i,r){return{getAppApi:e.getApi,initMainR:t,specMapUtils:n,appsUtils:i,registerDeps:r.registerDeps}});
//# sourceMappingURL=wixCodeInit.min.js.map